{{- $context := merge (dict "app" $.Values.userServer) . -}}
{{- $mailApp :=  merge (dict "app" $.Values.mailServer) . -}}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "neves.name.configmap" $context }}
  namespace: {{ $.Values.teamName }}
  labels:
    {{- include "neves.commonLabels" $context | nindent 4 }}
{{ with .Values.userServer.config -}}
data:
  DB_HOST: {{ .db.host | quote  }}
  DB_NAME: {{ .db.name | quote  }}
  DB_PORT: {{ .db.port | quote  }}
  MAIL_API_URL: {{ printf "http://%s" (include "neves.url.svc" $mailApp) | quote  }}
  CORS_ALLOWED_ORIGINS: {{ .corsAllowedOrigins | quote  }}
{{ end }}