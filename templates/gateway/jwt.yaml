{{ $userApp := merge (dict "app" $.Values.userServer) . -}}

apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-authentication
spec:
  selector:
    matchLabels:
      jwt: first
  jwtRules:
    - issuer: "neves.com"
      forwardOriginalToken: true
      jwksUri: {{ printf "http://%s/users/.well-known/jwks.json" (include "neves.url.svc" $userApp) }}
      fromHeaders:
        - name: "Www-Authorization"